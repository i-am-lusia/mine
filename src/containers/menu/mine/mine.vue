<template>
  <div id="mine">
    <el-tabs class="tab">
      <el-tab-pane>
        <span slot="label">
          <span class="pane1">æˆ‘çš„</span>
        </span>
        <div id="own">
          <!-- ä¸ªäººä¿¡æ¯è¡¨ -->
          <div
            class="ownBlock"
            style="width: 90%; height: 3rem; margin-top: 1rem"
          >
            <div id="personal">
              <img class="headPic" :src="headPic" />
              <div class="box">
                <div class="personalButtons" style="margin-left: 2rem">
                  <div class="font-size: .6rem;margin-left: .6rem">
                    {{ userName }}
                  </div>
                  <img
                    style="width: 0.5rem; height: 0.5rem; margin-left: 0.1rem"
                    src="@/assets/images/vip1.png"
                  />
                  <img
                    style="width: 0.5rem; height: 0.5rem; margin-left: 0.1rem"
                    src="@/assets/images/vip1.png"
                  />
                  <img
                    style="width: 0.5rem; height: 0.5rem; margin-left: 0.1rem"
                    src="@/assets/images/vip1.png"
                  />
                </div>
                <div
                  class="personalButtons"
                  style="justify-content: flex-start"
                >
                  <div style="border-right: gainsboro solid 2px">
                    <span style="color: black">å…³æ³¨</span>
                    <span
                      style="
                        color: gainsboro;
                        margin-left: 0.2rem;
                        margin-right: 0.3rem;
                      "
                      >1</span
                    >
                  </div>
                  <div style="border-right: gainsboro solid 2px">
                    <span style="color: black">ç²‰ä¸</span>
                    <span
                      style="
                        color: gainsboro;
                        margin-left: 0.2rem;
                        margin-right: 0.3rem;
                      "
                      >2</span
                    >
                  </div>
                  <div style="border-right: gainsboro solid 2px">
                    <span style="color: black">æ–°æ­Œæé†’</span>
                    <span
                      style="
                        color: gainsboro;
                        margin-left: 0.2rem;
                        margin-right: 0.3rem;
                      "
                      >3</span
                    >
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- æ´»åŠ¨ä¸­å¿ƒ -->
          <div class="ownBlock" style="width:90%;height: 2rem">
            <div id="activity">
              <div style="display: flex;justify-content: center;">
                <img style="width:1rem;height:1rem" src="@/assets/images/act1.png" />
                <div style="margin-left:.2rem">
                  <div style="font-size: .5rem;">æ´»åŠ¨ä¸­å¿ƒ</div>
                  <div style="color:grey;font-size: .35rem;">ç­¾åˆ°ä¸ƒå¤©èµ¢ç»¿ç –</div>
                </div>
              </div>
              <div style="display: flex;justify-content: center;margin-left: .5rem">
                <img style="width:1rem;height:1rem" src="@/assets/images/act2.png" />
                <div style="margin-left:.2rem">
                  <div style="font-size: .5rem;">ä¼šå‘˜ä¸­å¿ƒ</div>
                  <div style="color:grey;font-size: .35rem;">VIPçƒ­é—¨æ–°ç¢ŸğŸµ</div>
                </div>
              </div>
            </div>
          </div>
          <!-- æŒ‰é”® -->
          <div class="ownBlock" style="width:90%;height: 3rem">
             <div style="display: flex;flex-direction: column;justify-content: center;align-items: center;margin: .5rem;">
                <img style="width: 1rem;" src="@/assets/images/heart1.png">
                <span style="font-size:.4rem;margin-top: .15rem">å–œæ¬¢</span>
                <span style="font-size:.2rem;color: gray;">{{this.likeSong.length}}</span>
            </div>
            <div style="display: flex;flex-direction: column;justify-content: center;align-items: center;margin: .5rem;">
                <img style="width: 1rem;"  src="@/assets/images/download1.png">
                <span style="font-size:.4rem;margin-top: .15rem">æœ¬åœ°</span>
                <span style="font-size:.2rem;color: gray;">1234</span>
            </div>
            <div style="display: flex;flex-direction: column;justify-content: center;align-items: center;margin: .5rem;">
                <img style="width: 1rem;" src="@/assets/images/songlist2.png">
                <span style="font-size:.4rem;margin-top: .15rem">æ­Œå•</span>
                <span style="font-size:.2rem;color: gray;">1234</span>
            </div>
            <div style="display: flex;flex-direction: column;justify-content: center;align-items: center;margin: .5rem;">
                <img style="width: 1rem;" src="@/assets/images/yigou.png">
                <span style="font-size:.4rem;margin-top: .15rem">å·²è´­</span>
                <span style="font-size:.2rem;color: gray;">1234</span>
            </div>
          </div>
          <!-- æœ€è¿‘æ’­æ”¾ -->
          <div class="ownBlock" style="background: white">
            <songlist :songListData="nearSongData"></songlist>
          </div>
          <!-- è‡ªå»ºæ­Œå• -->
          <div class="ownBlock" style="background: white">
            <songlist :songListData="ownSongData"></songlist>
          </div>
          <!-- æ¨èæ­Œå• -->
          <div class="ownBlock" style="background: white;height: 8rem">
            <songlist :songListData="recommendSongData"></songlist>
          </div>
        </div>
      </el-tab-pane>
    </el-tabs>
    <span class="el-icon-message" @click="toMessage"></span>
    <span class="el-icon-more" @click="toMore"></span>
  </div>
</template>
<script>
import more from '@/components/pages/fourth/more/more.vue'
import messages from '@/components/pages/fourth/messages/messages.vue'
import Songlist from '../../../components/songlist/songlist.vue'
import axios from 'axios'
export default {
  name: 'mine',
  components: {
    more,
    messages,
    Songlist
  },
  data () {
    return {
      isMore: false,
      isMessage: false,
      headPic: this.$store.state.userData
        ? this.$store.state.userData.profile.avatarUrl
        : null,
      userData: this.$store.state.userData ? this.$store.state.userData : null,
      userName: this.$store.state.userData
        ? this.$store.state.userData.profile.nickname
        : null,
      nearSongData: {
        listName: 'æœ€è¿‘æ’­æ”¾',
        listData: this.$store.state.nearlist ? this.$store.state.nearlist : []
      },
      ownSongData: {
        listName: 'è‡ªå»ºæ­Œå•',
        listData: []
      },
      recommendSongData: {
        listName: 'æ¨èæ­Œå•',
        listData: []
      },
      likeSong: []
    }
  },
  methods: {
    toMore () {
      this.isMore = true
    },
    toMessage () {
      this.isMessage = true
    },
    closeMore () {
      this.isMore = false
    },
    closeMessage () {
      this.isMessage = false
    },
    /** æ”¶è—æ­Œå• */
    async getColletSongData () {
      const res = await axios({
        url: `http://localhost:3000/album/sublist`,
        withCredentials: true
      })
      this.ownSongData.listData = res.data.data
    },
    /** æ¨èæ­Œå• */
    async getRecommandSongData () {
      const res = await axios({
        url: `http://localhost:3000/personalized?limit=3`,
        withCredentials: true
      })
      this.recommendSongData.listData = res.data.result
    },
    /** è·å–å–œå¥½æ­Œå•åˆ—è¡¨ */
    async getLikeSong () {
      const res = await axios({
        url: `http://localhost:3000/likelist?uid=${this.userData.profile.userId}`,
        withCredentials: true
      })
      this.likeSong = res.data.ids
      console.log(this.likeSong)
    }
  },
  mounted () {
    this.getColletSongData()
    this.getRecommandSongData()
    console.log(this.nearSongData)
    console.log(this.userData)
  },
  computed: {
    getUserData () {
      return this.$store.state.userData
    },
    getNearSongData () {
      return this.$store.state.nearlist
    }
  },
  watch: {
    getUserData (newVal, oldVal) {
      this.userName = this.$store.state.userData.profile.nickname
      this.headPic = this.$store.state.userData.profile.avatarUrl
      this.userData = this.$store.state.userData
      this.getLikeSong()
    },
    getNearSongData (newVal, oldVal) {
      this.nearSongData.listData = newVal
    }
  }
}
</script>
<style scoped>
@import "./index.css";
#own {
  width: 100%;
  height: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  background-color: whitesmoke;
}
.ownBlock {
  width: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
}
</style>
